language:
- objective-c
- c++
compiler:
- clang
sudo: false
os: osx
osx_image: xcode7.3
script:
- mkdir build
- cd build
- cmake -G Xcode ..
- cmake --build . --config Release | sed 's/-Wl,-.*//g'
- ctest -C Release . -V
- cd ..
- PACKAGE_NAME=`echo $TRAVIS_REPO_SLUG | sed 's/.*\///g'`
- PACKAGE_REV=`echo $TRAVIS_COMMIT | sed -e 's/^[[:alnum:]]\{6\}/&-/g' | sed 's/-.*//'`
- mkdir $PACKAGE_NAME
- if [ -e package-info.json ]; then cp package-info.json $PACKAGE_NAME; fi
- for f in *.md; do [ -e "$f" ] && cp "$f" $PACKAGE_NAME ; done
- if [ -e icon.png ]; then cp icon.png $PACKAGE_NAME; fi
- if [ -d docs ]; then cp -r docs $PACKAGE_NAME; fi
- if [ -d extensions ]; then cp -r extensions $PACKAGE_NAME; fi
- if [ -d externals ]; then cp -r externals $PACKAGE_NAME; fi
- if [ -d extras ]; then cp -r extras $PACKAGE_NAME; fi
- if [ -d help ]; then cp -r help $PACKAGE_NAME; fi
- if [ -d init ]; then cp -r init $PACKAGE_NAME; fi
- if [ -d javascript ]; then cp -r javascript $PACKAGE_NAME; fi
- if [ -d media ]; then cp -r media $PACKAGE_NAME; fi
- if [ -d misc ]; then cp -r misc $PACKAGE_NAME; fi
- if [ -d patchers ]; then cp -r help $PACKAGE_NAME; fi
- mkdir dist
- zip -r dist/$PACKAGE_NAME-$PACKAGE_REV.zip $PACKAGE_NAME
deploy:
  provider: s3
  access_key_id: AKIAIWE3SI2TMXC5AJBA
  secret_access_key:
    secure: KfXQgPYUqXC7NtCjVFDAyg0s2bZvhDcYlNkhSYU2QLGYC2u01JsUc0tVs1VdznroIJKAVID5wGbMCg1vMjSXJsJdZyRsaGsaSvsdLVqoqRZAgfTESN/x7swybwB/dIvgwuha42citpjyiWwOvPt9JrhxhDCjI/FhjjjN1jx/0u3hb7g4tvWTmt7uHA+czCo6u6qtPG4HqBXvAf2VzM4c4S1I9qIKAVeNlwNZ+ePZtIlDptLGN2L0t/PDWKdj+gzvrAt4Z670KaelDGjftAMVONkuo8tc002s/xOmvF46Fd1woCcbljI6EovCaD1YYbCQri5aglMRIphUtmktNDmBbiIy2gdVI8ddMuyWtA3FRsEcCr8eObQqpfZbFQhpXuRTioUGVHvbg4SIR7CePJaUQ//Mt3jBf9CPt+Kq5Cu8yIB2+ymd6PUiMy0qy9AOuuFjLqmcAuWMccFd13MuCXnFTLeTYWtSa05jnIHZ7Xo36GtWFt9oVXNnmI0wXuUcg798uhCNPNBN1NS35DIm4GEe5JJyv/9g3Tuavg+TjlHXRQkQnTD8gJnSmLW13NA+0mCEoryruIvwcQ4nUe6nB0uZnP5gfk0JG77VV2X2Qhx+nk7MMFFl0XTE+BvVkoku8gDcNjHsAGNfBmMSyb+gvhK5Ozx5GFO2A3wQRIUzNWwH5oc=
  bucket: cycling74-ci
  skip_cleanup: true
  local-dir: dist
  upload-dir: ease
  acl: public_read
  on:
    repo: Cycling74/ease
